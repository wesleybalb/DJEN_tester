async function obterComunicacoes(){let a=document.getElementById("dataInicio").value,b=document.getElementById("dataFim").value,c=document.getElementById("OAB").value,d=document.getElementById("UF").value,e=`https://comunicaapi.pje.jus.br/api/v1/comunicacao?numeroOab=${c}&ufOab=${d}&dataDisponibilizacaoInicio=${a}&dataDisponibilizacaoFim=${b}`,f={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Accept:"application/json"};try{let g=await fetch(e,{headers:f});if(!g.ok)throw new Error(`Erro na requisição: ${g.status} - ${await g.text()}`);let h=await g.json();if(h.items&&Array.isArray(h.items)){let i=j=>!j||j.length!==20?j:`${j.slice(0,7)}-${j.slice(7,9)}.${j.slice(9,13)}.${j.slice(13,14)}.${j.slice(14,16)}.${j.slice(16)}`,k=h.items.map(l=>({ID:l.id||"",["Data Disponibilização"]:l.data_disponibilizacao||"",Tribunal:l.siglaTribunal||"",["Tipo Comunicação"]:l.tipoComunicacao||"",Órgão:l.nomeOrgao||"",Texto:l.texto||"",["Número Processo"]:i(l.numero_processo||""),Link:l.link||"",["Tipo Documento"]:l.tipoDocumento||"",Classe:l.nomeClasse||"",["Número Comunicação"]:l.numeroComunicacao||"",Status:l.status||"",Meio:l.meiocompleto||"",Destinatários:(l.destinatarios||[]).map(m=>m.nome).join(", "),Advogados:(l.destinatarioadvogados||[]).map(n=>n.advogado.nome).join(", ")})),o=XLSX.utils.json_to_sheet(k),p=XLSX.utils.book_new();XLSX.utils.book_append_sheet(p,o,"Comunicações OAB");let q=new Date(),r=`${q.getFullYear()}_${(q.getMonth()+1).toString().padStart(2,"0")}_${q.getDate().toString().padStart(2,"0")}_${q.getHours().toString().padStart(2,"0")}${q.getMinutes().toString().padStart(2,"0")}${q.getSeconds().toString().padStart(2,"0")}`,s=`comunicacoes_oab_${r}.xlsx`;XLSX.writeFile(p,s),alert("Arquivo Excel gerado com sucesso!")}else alert("Nenhuma comunicação encontrada.")}catch(t){console.error("Erro ao obter comunicações:",t),alert("Erro ao obter comunicações. Veja o console para mais detalhes.")}}
